## generate & use patch file

### git diff

`git diff [target] > xxx.diff` generates a diff file. 'target' is optional, can be a branch or commit id, to 'diff-with'.

e.g. `git diff master > tmp.diff` generates diff file to local master HEAD.

### git apply

`git apply xxx.diff` to apply a diff file to current status.

### git format-patch

`git format-patch [ <since> | <revision range> ]` to generate patches for e-mail submission. Will generate a patch file like 0001-commit-msg.patch for each commit. 

Examples:

`git format-patch origin` extract all commits which are in the current branch but not in the origin branch.

`git format-patch -3` extract three topmost commits from the current branch.

`git format-patch COMMIT_ID_1..COMMIT_ID_n` specifies commit ranges to generate patch files.

Use `--start-number $N` option to start numbering the patches at N instead of 1.

### git am

Apply a series of patches (generated by `git format-patch`).


## squash commits

1. Checkout the target branch (or create a temporary branch from it), then do:

   ```
   git merge --squash WORKING_BRANCH
   git commit ...
   ```

   This is an elegant way.

2. On working branch, do: (If you already merged target branch during working, this could be messed up)

   ```
   # Reset the current branch to the commit just before the last N:
   git reset --hard HEAD~$N
   
   # HEAD@{1} is where the branch was just before the previous command.
   git merge --squash HEAD@{1}
   
   git commit ...
   ```
